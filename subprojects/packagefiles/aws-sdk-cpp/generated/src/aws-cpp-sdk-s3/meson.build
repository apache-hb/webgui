src = files(
    'source/S3EndpointRules.cpp',
    'source/S3Request.cpp',
    'source/S3ExpressSigner.cpp',
    'source/S3Errors.cpp',
    'source/S3ErrorMarshaller.cpp',
    'source/S3ClientConfiguration.cpp',
    'source/S3EndpointProvider.cpp',
    'source/S3ExpressIdentityProvider.cpp',
    'source/S3ExpressSignerProvider.cpp',
    'source/S3Client.cpp',
    'source/model/CompleteMultipartUploadResult.cpp',
    'source/model/DeleteBucketOwnershipControlsRequest.cpp',
    'source/model/ListBucketMetricsConfigurationsResult.cpp',
    'source/model/GetObjectTorrentRequest.cpp',
    'source/model/CopyObjectRequest.cpp',
    'source/model/DeleteMarkerReplication.cpp',
    'source/model/GetBucketPolicyRequest.cpp',
    'source/model/InventoryTableConfigurationResult.cpp',
    'source/model/DeleteBucketIntelligentTieringConfigurationRequest.cpp',
    'source/model/CopyObjectResultDetails.cpp',
    'source/model/FilterRule.cpp',
    'source/model/GetBucketMetadataConfigurationSdkResult.cpp',
    'source/model/ListBucketMetricsConfigurationsRequest.cpp',
    'source/model/CreateMultipartUploadRequest.cpp',
    'source/model/PutBucketVersioningRequest.cpp',
    'source/model/ReplicationTimeValue.cpp',
    'source/model/PutBucketOwnershipControlsRequest.cpp',
    'source/model/ListBucketInventoryConfigurationsResult.cpp',
    'source/model/Grantee.cpp',
    'source/model/GetObjectTaggingResult.cpp',
    'source/model/ListBucketIntelligentTieringConfigurationsResult.cpp',
    'source/model/GetBucketCorsRequest.cpp',
    'source/model/PutObjectLegalHoldRequest.cpp',
    'source/model/PutBucketLoggingRequest.cpp',
    'source/model/Delete.cpp',
    'source/model/GetBucketMetadataConfigurationResult.cpp',
    'source/model/Destination.cpp',
    'source/model/ListBucketInventoryConfigurationsRequest.cpp',
    'source/model/QuoteFields.cpp',
    'source/model/PutObjectAclResult.cpp',
    'source/model/ProgressEvent.cpp',
    'source/model/VersioningConfiguration.cpp',
    'source/model/CreateBucketMetadataTableConfigurationRequest.cpp',
    'source/model/TopicConfigurationDeprecated.cpp',
    'source/model/GetPublicAccessBlockResult.cpp',
    'source/model/LifecycleConfiguration.cpp',
    'source/model/PutBucketPolicyRequest.cpp',
    'source/model/PutObjectTaggingRequest.cpp',
    'source/model/RenameObjectResult.cpp',
    'source/model/InvalidObjectState.cpp',
    'source/model/LambdaFunctionConfiguration.cpp',
    'source/model/ReplicaModificationsStatus.cpp',
    'source/model/ObjectLockRule.cpp',
    'source/model/TargetObjectKeyFormat.cpp',
    'source/model/DeleteMarkerReplicationStatus.cpp',
    'source/model/DeleteBucketRequest.cpp',
    'source/model/MetadataConfigurationResult.cpp',
    'source/model/DeleteBucketMetadataTableConfigurationRequest.cpp',
    'source/model/AnalyticsExportDestination.cpp',
    'source/model/GetObjectLockConfigurationRequest.cpp',
    'source/model/NoncurrentVersionExpiration.cpp',
    'source/model/PutBucketWebsiteRequest.cpp',
    'source/model/GetObjectAttributesParts.cpp',
    'source/model/ReplicationTimeStatus.cpp',
    'source/model/InventoryFilter.cpp',
    'source/model/GetBucketLocationResult.cpp',
    'source/model/GetBucketEncryptionResult.cpp',
    'source/model/GetObjectRetentionRequest.cpp',
    'source/model/GetPublicAccessBlockRequest.cpp',
    'source/model/InventoryFormat.cpp',
    'source/model/ObjectLockEnabled.cpp',
    'source/model/PutBucketNotificationConfigurationRequest.cpp',
    'source/model/GetBucketLoggingResult.cpp',
    'source/model/SessionMode.cpp',
    'source/model/DefaultRetention.cpp',
    'source/model/ListObjectsRequest.cpp',
    'source/model/LifecycleRule.cpp',
    'source/model/UploadPartCopyRequest.cpp',
    'source/model/ListBucketAnalyticsConfigurationsRequest.cpp',
    'source/model/CreateSessionRequest.cpp',
    'source/model/PutObjectLockConfigurationRequest.cpp',
    'source/model/GetObjectRequest.cpp',
    'source/model/GetBucketRequestPaymentRequest.cpp',
    'source/model/ServerSideEncryptionByDefault.cpp',
    'source/model/HeadBucketRequest.cpp',
    'source/model/ObjectVersionStorageClass.cpp',
    'source/model/ListBucketsResult.cpp',
    'source/model/ScanRange.cpp',
    'source/model/OwnershipControls.cpp',
    'source/model/MFADelete.cpp',
    'source/model/ChecksumType.cpp',
    'source/model/WriteGetObjectResponseRequest.cpp',
    'source/model/DeleteObjectRequest.cpp',
    'source/model/DeleteObjectsRequest.cpp',
    'source/model/PutBucketCorsRequest.cpp',
    'source/model/S3TablesBucketType.cpp',
    'source/model/InventoryOptionalField.cpp',
    'source/model/Encryption.cpp',
    'source/model/DeleteObjectsResult.cpp',
    'source/model/IntelligentTieringConfiguration.cpp',
    'source/model/AccessControlTranslation.cpp',
    'source/model/GetBucketMetadataConfigurationRequest.cpp',
    'source/model/Tier.cpp',
    'source/model/PutObjectAclRequest.cpp',
    'source/model/GetBucketMetricsConfigurationResult.cpp',
    'source/model/BucketVersioningStatus.cpp',
    'source/model/S3KeyFilter.cpp',
    'source/model/RedirectAllRequestsTo.cpp',
    'source/model/InventoryConfigurationState.cpp',
    'source/model/BucketType.cpp',
    'source/model/ListObjectsResult.cpp',
    'source/model/DeleteObjectTaggingRequest.cpp',
    'source/model/ExistingObjectReplicationStatus.cpp',
    'source/model/MetadataTableEncryptionConfiguration.cpp',
    'source/model/RenameObjectRequest.cpp',
    'source/model/Stats.cpp',
    'source/model/ReplicationRule.cpp',
    'source/model/Tiering.cpp',
    'source/model/ReplicationConfiguration.cpp',
    'source/model/ListObjectVersionsResult.cpp',
    'source/model/ObjectLockLegalHold.cpp',
    'source/model/TransitionDefaultMinimumObjectSize.cpp',
    'source/model/MetricsFilter.cpp',
    'source/model/DeleteBucketPolicyRequest.cpp',
    'source/model/CloudFunctionConfiguration.cpp',
    'source/model/InventoryTableConfiguration.cpp',
    'source/model/S3TablesDestination.cpp',
    'source/model/ObjectVersion.cpp',
    'source/model/Metrics.cpp',
    'source/model/GetBucketMetadataTableConfigurationSdkResult.cpp',
    'source/model/ObjectLockConfiguration.cpp',
    'source/model/WebsiteConfiguration.cpp',
    'source/model/QueueConfiguration.cpp',
    'source/model/ServerSideEncryptionConfiguration.cpp',
    'source/model/ReplicationRuleAndOperator.cpp',
    'source/model/GetBucketEncryptionRequest.cpp',
    'source/model/IntelligentTieringAccessTier.cpp',
    'source/model/GetObjectAclRequest.cpp',
    'source/model/SelectParameters.cpp',
    'source/model/CompleteMultipartUploadRequest.cpp',
    'source/model/CSVOutput.cpp',
    'source/model/IntelligentTieringFilter.cpp',
    'source/model/S3TablesDestinationResult.cpp',
    'source/model/RecordExpiration.cpp',
    'source/model/MultipartUpload.cpp',
    'source/model/Type.cpp',
    'source/model/CORSConfiguration.cpp',
    'source/model/ListPartsRequest.cpp',
    'source/model/CommonPrefix.cpp',
    'source/model/JournalTableConfigurationResult.cpp',
    'source/model/LocationType.cpp',
    'source/model/AccessControlPolicy.cpp',
    'source/model/RestoreObjectResult.cpp',
    'source/model/IndexDocument.cpp',
    'source/model/GetBucketPolicyResult.cpp',
    'source/model/NotificationConfigurationFilter.cpp',
    'source/model/SimplePrefix.cpp',
    'source/model/GetObjectTaggingRequest.cpp',
    'source/model/GetObjectLockConfigurationResult.cpp',
    'source/model/ObjectLockLegalHoldStatus.cpp',
    'source/model/GetBucketLocationRequest.cpp',
    'source/model/StorageClass.cpp',
    'source/model/Permission.cpp',
    'source/model/InventoryConfiguration.cpp',
    'source/model/HeadObjectRequest.cpp',
    'source/model/BucketLoggingStatus.cpp',
    'source/model/MetadataTableConfigurationResult.cpp',
    'source/model/PutBucketEncryptionRequest.cpp',
    'source/model/RestoreRequestType.cpp',
    'source/model/DeleteBucketMetadataConfigurationRequest.cpp',
    'source/model/DeleteBucketTaggingRequest.cpp',
    'source/model/NoncurrentVersionTransition.cpp',
    'source/model/PutBucketRequestPaymentRequest.cpp',
    'source/model/GetObjectAclResult.cpp',
    'source/model/GetBucketAclRequest.cpp',
    'source/model/GetObjectLegalHoldRequest.cpp',
    'source/model/GetBucketAccelerateConfigurationResult.cpp',
    'source/model/ListBucketAnalyticsConfigurationsResult.cpp',
    'source/model/Object.cpp',
    'source/model/DeleteBucketInventoryConfigurationRequest.cpp',
    'source/model/DeletedObject.cpp',
    'source/model/EncryptionConfiguration.cpp',
    'source/model/NotificationConfiguration.cpp',
    'source/model/DeleteBucketLifecycleRequest.cpp',
    'source/model/GetBucketWebsiteResult.cpp',
    'source/model/ListBucketIntelligentTieringConfigurationsRequest.cpp',
    'source/model/GetObjectAttributesRequest.cpp',
    'source/model/HeadObjectResult.cpp',
    'source/model/CreateBucketMetadataConfigurationRequest.cpp',
    'source/model/Owner.cpp',
    'source/model/CreateSessionResult.cpp',
    'source/model/InventorySchedule.cpp',
    'source/model/MetadataDirective.cpp',
    'source/model/Condition.cpp',
    'source/model/Protocol.cpp',
    'source/model/GetBucketOwnershipControlsResult.cpp',
    'source/model/LoggingEnabled.cpp',
    'source/model/Grant.cpp',
    'source/model/PutBucketInventoryConfigurationRequest.cpp',
    'source/model/PutObjectLegalHoldResult.cpp',
    'source/model/ObjectAttributes.cpp',
    'source/model/RoutingRule.cpp',
    'source/model/ListPartsResult.cpp',
    'source/model/ListBucketsRequest.cpp',
    'source/model/OwnershipControlsRule.cpp',
    'source/model/GetBucketNotificationConfigurationResult.cpp',
    'source/model/InventoryFrequency.cpp',
    'source/model/JournalTableConfigurationUpdates.cpp',
    'source/model/IntelligentTieringStatus.cpp',
    'source/model/DestinationResult.cpp',
    'source/model/SSES3.cpp',
    'source/model/CreateMultipartUploadResult.cpp',
    'source/model/CreateBucketRequest.cpp',
    'source/model/ExpirationState.cpp',
    'source/model/GetObjectResult.cpp',
    'source/model/FileHeaderInfo.cpp',
    'source/model/SelectObjectContentInitialResponse.cpp',
    'source/model/GetBucketMetadataTableConfigurationResult.cpp',
    'source/model/MetricsAndOperator.cpp',
    'source/model/OutputSerialization.cpp',
    'source/model/RestoreStatus.cpp',
    'source/model/ReplicationRuleFilter.cpp',
    'source/model/ReplicationRuleStatus.cpp',
    'source/model/BucketLocationConstraint.cpp',
    'source/model/CompletedPart.cpp',
    'source/model/PutObjectTaggingResult.cpp',
    'source/model/AnalyticsS3ExportFileFormat.cpp',
    'source/model/InventoryIncludedObjectVersions.cpp',
    'source/model/GetObjectTorrentResult.cpp',
    'source/model/GetBucketIntelligentTieringConfigurationResult.cpp',
    'source/model/PartitionedPrefix.cpp',
    'source/model/MetadataConfiguration.cpp',
    'source/model/NotificationConfigurationDeprecated.cpp',
    'source/model/StorageClassAnalysisSchemaVersion.cpp',
    'source/model/PutObjectRetentionResult.cpp',
    'source/model/GetBucketAnalyticsConfigurationResult.cpp',
    'source/model/GetBucketNotificationConfigurationRequest.cpp',
    'source/model/SelectObjectContentHandler.cpp',
    'source/model/GetBucketMetricsConfigurationRequest.cpp',
    'source/model/OutputLocation.cpp',
    'source/model/Progress.cpp',
    'source/model/CORSRule.cpp',
    'source/model/RestoreRequest.cpp',
    'source/model/HeadBucketResult.cpp',
    'source/model/ListObjectVersionsRequest.cpp',
    'source/model/CreateBucketResult.cpp',
    'source/model/OptionalObjectAttributes.cpp',
    'source/model/PutBucketTaggingRequest.cpp',
    'source/model/AbortIncompleteMultipartUpload.cpp',
    'source/model/Part.cpp',
    'source/model/PutObjectResult.cpp',
    'source/model/LocationInfo.cpp',
    'source/model/EncodingType.cpp',
    'source/model/ReplicaModifications.cpp',
    'source/model/MFADeleteStatus.cpp',
    'source/model/DeleteBucketMetricsConfigurationRequest.cpp',
    'source/model/PutBucketAclRequest.cpp',
    'source/model/AbortMultipartUploadResult.cpp',
    'source/model/GetBucketLifecycleConfigurationRequest.cpp',
    'source/model/CreateBucketConfiguration.cpp',
    'source/model/PutBucketIntelligentTieringConfigurationRequest.cpp',
    'source/model/ExistingObjectReplication.cpp',
    'source/model/ObjectIdentifier.cpp',
    'source/model/GetBucketInventoryConfigurationResult.cpp',
    'source/model/InventoryEncryption.cpp',
    'source/model/QueueConfigurationDeprecated.cpp',
    'source/model/GetBucketMetadataTableConfigurationRequest.cpp',
    'source/model/JSONType.cpp',
    'source/model/GetBucketTaggingRequest.cpp',
    'source/model/GetBucketOwnershipControlsRequest.cpp',
    'source/model/MetadataTableConfiguration.cpp',
    'source/model/UpdateBucketMetadataJournalTableConfigurationRequest.cpp',
    'source/model/GetBucketCorsResult.cpp',
    'source/model/AnalyticsFilter.cpp',
    'source/model/SseKmsEncryptedObjects.cpp',
    'source/model/GetBucketTaggingResult.cpp',
    'source/model/ObjectOwnership.cpp',
    'source/model/ReplicationTime.cpp',
    'source/model/GetObjectRetentionResult.cpp',
    'source/model/DeleteBucketWebsiteRequest.cpp',
    'source/model/DeleteMarkerEntry.cpp',
    'source/model/Rule.cpp',
    'source/model/SessionCredentials.cpp',
    'source/model/UpdateBucketMetadataInventoryTableConfigurationRequest.cpp',
    'source/model/EventBridgeConfiguration.cpp',
    'source/model/DeleteBucketEncryptionRequest.cpp',
    'source/model/RestoreObjectRequest.cpp',
    'source/model/DeletePublicAccessBlockRequest.cpp',
    'source/model/ExpirationStatus.cpp',
    'source/model/ServerSideEncryptionRule.cpp',
    'source/model/Payer.cpp',
    'source/model/UploadPartRequest.cpp',
    'source/model/LifecycleExpiration.cpp',
    'source/model/MetricsConfiguration.cpp',
    'source/model/DeleteObjectResult.cpp',
    'source/model/UploadPartCopyResult.cpp',
    'source/model/GetBucketPolicyStatusResult.cpp',
    'source/model/ListDirectoryBucketsRequest.cpp',
    'source/model/PutBucketLifecycleConfigurationRequest.cpp',
    'source/model/GetBucketAclResult.cpp',
    'source/model/DeleteBucketReplicationRequest.cpp',
    'source/model/ParquetInput.cpp',
    'source/model/GetBucketInventoryConfigurationRequest.cpp',
    'source/model/Initiator.cpp',
    'source/model/ExpressionType.cpp',
    'source/model/Redirect.cpp',
    'source/model/AbortMultipartUploadRequest.cpp',
    'source/model/AnalyticsAndOperator.cpp',
    'source/model/PutBucketMetricsConfigurationRequest.cpp',
    'source/model/ObjectCannedACL.cpp',
    'source/model/LifecycleRuleFilter.cpp',
    'source/model/IntelligentTieringAndOperator.cpp',
    'source/model/TopicConfiguration.cpp',
    'source/model/ObjectStorageClass.cpp',
    'source/model/GetBucketVersioningResult.cpp',
    'source/model/GetBucketReplicationResult.cpp',
    'source/model/BucketInfo.cpp',
    'source/model/ListObjectsV2Result.cpp',
    'source/model/PutBucketAccelerateConfigurationRequest.cpp',
    'source/model/GetBucketAccelerateConfigurationRequest.cpp',
    'source/model/ChecksumAlgorithm.cpp',
    'source/model/DeleteBucketCorsRequest.cpp',
    'source/model/ErrorDocument.cpp',
    'source/model/TargetGrant.cpp',
    'source/model/BucketCannedACL.cpp',
    'source/model/RequestProgress.cpp',
    'source/model/StorageClassAnalysisDataExport.cpp',
    'source/model/GetBucketReplicationRequest.cpp',
    'source/model/ReplicationStatus.cpp',
    'source/model/GetObjectAttributesResult.cpp',
    'source/model/SseKmsEncryptedObjectsStatus.cpp',
    'source/model/RequestPayer.cpp',
    'source/model/StatsEvent.cpp',
    'source/model/TransitionStorageClass.cpp',
    'source/model/InventoryDestination.cpp',
    'source/model/Transition.cpp',
    'source/model/CompletedMultipartUpload.cpp',
    'source/model/ListMultipartUploadsResult.cpp',
    'source/model/SelectObjectContentRequest.cpp',
    'source/model/CopyPartResult.cpp',
    'source/model/PutBucketReplicationRequest.cpp',
    'source/model/ArchiveStatus.cpp',
    'source/model/ObjectLockRetentionMode.cpp',
    'source/model/OwnerOverride.cpp',
    'source/model/DeleteObjectTaggingResult.cpp',
    'source/model/ChecksumMode.cpp',
    'source/model/BucketAccelerateStatus.cpp',
    'source/model/ObjectPart.cpp',
    'source/model/JSONOutput.cpp',
    'source/model/DataRedundancy.cpp',
    'source/model/GetBucketAnalyticsConfigurationRequest.cpp',
    'source/model/AnalyticsS3BucketDestination.cpp',
    'source/model/GetBucketPolicyStatusRequest.cpp',
    'source/model/S3Location.cpp',
    'source/model/InventoryS3BucketDestination.cpp',
    'source/model/PutObjectRetentionRequest.cpp',
    'source/model/InputSerialization.cpp',
    'source/model/PutObjectRequest.cpp',
    'source/model/JSONInput.cpp',
    'source/model/RequestCharged.cpp',
    'source/model/LifecycleRuleAndOperator.cpp',
    'source/model/Event.cpp',
    'source/model/GetBucketRequestPaymentResult.cpp',
    'source/model/Bucket.cpp',
    'source/model/BucketLifecycleConfiguration.cpp',
    'source/model/GetBucketLoggingRequest.cpp',
    'source/model/CompressionType.cpp',
    'source/model/TaggingDirective.cpp',
    'source/model/GetBucketLifecycleConfigurationResult.cpp',
    'source/model/SSEKMS.cpp',
    'source/model/AccelerateConfiguration.cpp',
    'source/model/GetObjectLegalHoldResult.cpp',
    'source/model/Error.cpp',
    'source/model/MetricsStatus.cpp',
    'source/model/SourceSelectionCriteria.cpp',
    'source/model/GetBucketIntelligentTieringConfigurationRequest.cpp',
    'source/model/JournalTableConfiguration.cpp',
    'source/model/RequestPaymentConfiguration.cpp',
    'source/model/GlacierJobParameters.cpp',
    'source/model/PutBucketAnalyticsConfigurationRequest.cpp',
    'source/model/ListDirectoryBucketsResult.cpp',
    'source/model/ListObjectsV2Request.cpp',
    'source/model/CSVInput.cpp',
    'source/model/BucketLogsPermission.cpp',
    'source/model/DeleteBucketAnalyticsConfigurationRequest.cpp',
    'source/model/Tagging.cpp',
    'source/model/Checksum.cpp',
    'source/model/UploadPartResult.cpp',
    'source/model/InventoryTableConfigurationUpdates.cpp',
    'source/model/TableSseAlgorithm.cpp',
    'source/model/ObjectLockRetention.cpp',
    'source/model/PutBucketLifecycleConfigurationResult.cpp',
    'source/model/Tag.cpp',
    'source/model/StorageClassAnalysis.cpp',
    'source/model/ErrorDetails.cpp',
    'source/model/FilterRuleName.cpp',
    'source/model/PolicyStatus.cpp',
    'source/model/PartitionDateSource.cpp',
    'source/model/GetBucketWebsiteRequest.cpp',
    'source/model/PutPublicAccessBlockRequest.cpp',
    'source/model/MetadataEntry.cpp',
    'source/model/ServerSideEncryption.cpp',
    'source/model/ListMultipartUploadsRequest.cpp',
    'source/model/AnalyticsConfiguration.cpp',
    'source/model/PutObjectLockConfigurationResult.cpp',
    'source/model/CopyObjectResult.cpp',
    'source/model/PublicAccessBlockConfiguration.cpp',
    'source/model/GetBucketVersioningRequest.cpp',
    'source/model/ObjectLockMode.cpp'
)

inc = include_directories('include')

if host_machine.system() == 'windows' and get_option('default_library') == 'shared'
    cpp_args = ['-DAWS_S3_EXPORTS=1']
else
    cpp_args = []
endif

libaws_cpp_sdk_s3 = library(
    'aws-cpp-sdk-s3',
    src,
    include_directories: inc,
    cpp_args: cpp_args + public_cpp_args,
    dependencies: [
        aws_cpp_sdk_core_dep,
        dependency('threads'),
        cpp.find_library('dl', required: false),
    ],
    install: true,
    version: meson.project_version(),
)

aws_cpp_sdk_s3_dep = declare_dependency(
    include_directories: inc,
    link_with: libaws_cpp_sdk_s3,
    dependencies: [aws_cpp_sdk_core_dep],
    compile_args: public_cpp_args,
)

meson.override_dependency('aws-cpp-sdk-s3', aws_cpp_sdk_s3_dep)

pkgs += {
    'aws-cpp-sdk-s3': {
        'lib': libaws_cpp_sdk_s3,
        'extra_cflags': public_cpp_args,
    }
}
