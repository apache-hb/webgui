src = files(
    'source/CloudWatchClient.cpp',
    'source/CloudWatchEndpointRules.cpp',
    'source/CloudWatchRequest.cpp',
    'source/CloudWatchErrorMarshaller.cpp',
    'source/CloudWatchErrors.cpp',
    'source/CloudWatchEndpointProvider.cpp',
    'source/model/PutManagedInsightRulesResult.cpp',
    'source/model/ListManagedInsightRulesRequest.cpp',
    'source/model/PutMetricAlarmRequest.cpp',
    'source/model/InsightRule.cpp',
    'source/model/CompositeAlarm.cpp',
    'source/model/ResourceNotFoundException.cpp',
    'source/model/EnableInsightRulesResult.cpp',
    'source/model/ListDashboardsRequest.cpp',
    'source/model/SingleMetricAnomalyDetector.cpp',
    'source/model/MetricStreamEntry.cpp',
    'source/model/StatisticSet.cpp',
    'source/model/ManagedRuleDescription.cpp',
    'source/model/GetDashboardResult.cpp',
    'source/model/GetMetricStatisticsResult.cpp',
    'source/model/DescribeAlarmsRequest.cpp',
    'source/model/PutDashboardResult.cpp',
    'source/model/EnableInsightRulesRequest.cpp',
    'source/model/StopMetricStreamsRequest.cpp',
    'source/model/StatusCode.cpp',
    'source/model/SetAlarmStateRequest.cpp',
    'source/model/Metric.cpp',
    'source/model/ResponseMetadata.cpp',
    'source/model/MetricStreamOutputFormat.cpp',
    'source/model/StateValue.cpp',
    'source/model/GetMetricDataResult.cpp',
    'source/model/Datapoint.cpp',
    'source/model/PutMetricStreamRequest.cpp',
    'source/model/AnomalyDetector.cpp',
    'source/model/TagResourceRequest.cpp',
    'source/model/DashboardEntry.cpp',
    'source/model/UntagResourceResult.cpp',
    'source/model/PartialFailure.cpp',
    'source/model/GetMetricDataRequest.cpp',
    'source/model/LabelOptions.cpp',
    'source/model/DescribeAlarmsForMetricRequest.cpp',
    'source/model/DeleteInsightRulesResult.cpp',
    'source/model/DisableAlarmActionsRequest.cpp',
    'source/model/DescribeInsightRulesRequest.cpp',
    'source/model/PutMetricDataRequest.cpp',
    'source/model/AnomalyDetectorType.cpp',
    'source/model/DashboardValidationMessage.cpp',
    'source/model/Statistic.cpp',
    'source/model/InsightRuleMetricDatapoint.cpp',
    'source/model/Entity.cpp',
    'source/model/MetricStreamStatisticsConfiguration.cpp',
    'source/model/MetricDataResult.cpp',
    'source/model/GetMetricWidgetImageResult.cpp',
    'source/model/AnomalyDetectorConfiguration.cpp',
    'source/model/ManagedRule.cpp',
    'source/model/DeleteDashboardsResult.cpp',
    'source/model/ActionsSuppressedBy.cpp',
    'source/model/ListMetricsResult.cpp',
    'source/model/GetDashboardRequest.cpp',
    'source/model/ComparisonOperator.cpp',
    'source/model/Dimension.cpp',
    'source/model/StopMetricStreamsResult.cpp',
    'source/model/ListTagsForResourceResult.cpp',
    'source/model/PutMetricStreamResult.cpp',
    'source/model/MetricStreamStatisticsMetric.cpp',
    'source/model/InsightRuleContributor.cpp',
    'source/model/PutAnomalyDetectorResult.cpp',
    'source/model/DescribeAnomalyDetectorsRequest.cpp',
    'source/model/StandardUnit.cpp',
    'source/model/ListMetricStreamsResult.cpp',
    'source/model/MetricDatum.cpp',
    'source/model/AlarmContributor.cpp',
    'source/model/GetInsightRuleReportResult.cpp',
    'source/model/MetricAlarm.cpp',
    'source/model/DeleteMetricStreamRequest.cpp',
    'source/model/ListManagedInsightRulesResult.cpp',
    'source/model/DeleteAnomalyDetectorRequest.cpp',
    'source/model/InsightRuleContributorDatapoint.cpp',
    'source/model/GetMetricStreamResult.cpp',
    'source/model/DeleteDashboardsRequest.cpp',
    'source/model/DimensionFilter.cpp',
    'source/model/PutManagedInsightRulesRequest.cpp',
    'source/model/Range.cpp',
    'source/model/AnomalyDetectorStateValue.cpp',
    'source/model/MetricStreamFilter.cpp',
    'source/model/DisableInsightRulesResult.cpp',
    'source/model/AlarmType.cpp',
    'source/model/DescribeAlarmHistoryResult.cpp',
    'source/model/DescribeAlarmsForMetricResult.cpp',
    'source/model/DescribeInsightRulesResult.cpp',
    'source/model/ListMetricStreamsRequest.cpp',
    'source/model/UntagResourceRequest.cpp',
    'source/model/DescribeAlarmHistoryRequest.cpp',
    'source/model/PutInsightRuleRequest.cpp',
    'source/model/MessageData.cpp',
    'source/model/MetricDataQuery.cpp',
    'source/model/PutInsightRuleResult.cpp',
    'source/model/EnableAlarmActionsRequest.cpp',
    'source/model/ManagedRuleState.cpp',
    'source/model/StartMetricStreamsRequest.cpp',
    'source/model/HistoryItemType.cpp',
    'source/model/GetMetricStatisticsRequest.cpp',
    'source/model/DeleteAnomalyDetectorResult.cpp',
    'source/model/MetricStat.cpp',
    'source/model/ListTagsForResourceRequest.cpp',
    'source/model/AlarmHistoryItem.cpp',
    'source/model/DescribeAlarmsResult.cpp',
    'source/model/PutDashboardRequest.cpp',
    'source/model/DisableInsightRulesRequest.cpp',
    'source/model/PutCompositeAlarmRequest.cpp',
    'source/model/DeleteInsightRulesRequest.cpp',
    'source/model/PutAnomalyDetectorRequest.cpp',
    'source/model/GetInsightRuleReportRequest.cpp',
    'source/model/RecentlyActive.cpp',
    'source/model/ListMetricsRequest.cpp',
    'source/model/DeleteAlarmsRequest.cpp',
    'source/model/GetMetricWidgetImageRequest.cpp',
    'source/model/ListDashboardsResult.cpp',
    'source/model/DescribeAnomalyDetectorsResult.cpp',
    'source/model/DescribeAlarmContributorsResult.cpp',
    'source/model/ScanBy.cpp',
    'source/model/StartMetricStreamsResult.cpp',
    'source/model/DeleteMetricStreamResult.cpp',
    'source/model/MetricMathAnomalyDetector.cpp',
    'source/model/GetMetricStreamRequest.cpp',
    'source/model/Tag.cpp',
    'source/model/TagResourceResult.cpp',
    'source/model/MetricCharacteristics.cpp',
    'source/model/DescribeAlarmContributorsRequest.cpp',
    'source/model/EntityMetricData.cpp',
    'source/model/EvaluationState.cpp',
    'source/model/DashboardInvalidInputError.cpp'
)

inc = include_directories('include')

if host_machine.system() == 'windows' and get_option('default_library') == 'shared'
    cpp_args = ['-DAWS_CLOUDWATCH_EXPORTS=1']
else
    cpp_args = []
endif

libaws_cpp_sdk_monitoring = library(
    'aws-cpp-sdk-monitoring',
    src,
    include_directories: inc,
    cpp_args: cpp_args + public_cpp_args,
    dependencies: [aws_cpp_sdk_core_dep],
    install: true,
    version: meson.project_version(),
)

aws_cpp_sdk_monitoring_dep = declare_dependency(
    include_directories: inc,
    link_with: libaws_cpp_sdk_monitoring,
    dependencies: [aws_cpp_sdk_core_dep],
    compile_args: public_cpp_args,
)

meson.override_dependency('aws-cpp-sdk-monitoring', aws_cpp_sdk_monitoring_dep)

pkgs += {
    'aws-cpp-sdk-monitoring': {
        'lib': libaws_cpp_sdk_monitoring,
        'extra_cflags': public_cpp_args,
    }
}
