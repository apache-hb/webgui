src = files(
    'source/KMSErrorMarshaller.cpp',
    'source/KMSEndpointProvider.cpp',
    'source/KMSErrors.cpp',
    'source/KMSEndpointRules.cpp',
    'source/KMSClient.cpp',
    'source/KMSRequest.cpp',
    'source/model/EncryptionAlgorithmSpec.cpp',
    'source/model/SigningAlgorithmSpec.cpp',
    'source/model/DataKeyPairSpec.cpp',
    'source/model/ListKeyPoliciesRequest.cpp',
    'source/model/ReEncryptResult.cpp',
    'source/model/GetKeyPolicyRequest.cpp',
    'source/model/ImportType.cpp',
    'source/model/ReEncryptRequest.cpp',
    'source/model/RotationType.cpp',
    'source/model/GetKeyRotationStatusRequest.cpp',
    'source/model/GenerateDataKeyPairWithoutPlaintextResult.cpp',
    'source/model/GenerateDataKeyPairRequest.cpp',
    'source/model/ConnectCustomKeyStoreResult.cpp',
    'source/model/CreateCustomKeyStoreResult.cpp',
    'source/model/CreateGrantRequest.cpp',
    'source/model/CreateKeyResult.cpp',
    'source/model/RotateKeyOnDemandResult.cpp',
    'source/model/KeyAgreementAlgorithmSpec.cpp',
    'source/model/ListGrantsRequest.cpp',
    'source/model/GenerateRandomResult.cpp',
    'source/model/GenerateMacResult.cpp',
    'source/model/KeyEncryptionMechanism.cpp',
    'source/model/KeyState.cpp',
    'source/model/ExpirationModelType.cpp',
    'source/model/ImportKeyMaterialResult.cpp',
    'source/model/ConnectCustomKeyStoreRequest.cpp',
    'source/model/ConnectionStateType.cpp',
    'source/model/MultiRegionConfiguration.cpp',
    'source/model/GetKeyRotationStatusResult.cpp',
    'source/model/DecryptResult.cpp',
    'source/model/DisconnectCustomKeyStoreResult.cpp',
    'source/model/GenerateRandomRequest.cpp',
    'source/model/EnableKeyRequest.cpp',
    'source/model/RecipientInfo.cpp',
    'source/model/RevokeGrantRequest.cpp',
    'source/model/ConnectionErrorCodeType.cpp',
    'source/model/GrantConstraints.cpp',
    'source/model/CustomKeyStoreType.cpp',
    'source/model/KeySpec.cpp',
    'source/model/ScheduleKeyDeletionResult.cpp',
    'source/model/GetPublicKeyRequest.cpp',
    'source/model/GetParametersForImportResult.cpp',
    'source/model/TagResourceRequest.cpp',
    'source/model/UpdatePrimaryRegionRequest.cpp',
    'source/model/DisconnectCustomKeyStoreRequest.cpp',
    'source/model/DeleteImportedKeyMaterialRequest.cpp',
    'source/model/CreateGrantResult.cpp',
    'source/model/GetParametersForImportRequest.cpp',
    'source/model/MultiRegionKeyType.cpp',
    'source/model/XksProxyAuthenticationCredentialType.cpp',
    'source/model/XksProxyConnectivityType.cpp',
    'source/model/ListKeysRequest.cpp',
    'source/model/ListKeysResult.cpp',
    'source/model/ListRetirableGrantsResult.cpp',
    'source/model/ListAliasesResult.cpp',
    'source/model/GenerateDataKeyWithoutPlaintextResult.cpp',
    'source/model/ListAliasesRequest.cpp',
    'source/model/EncryptRequest.cpp',
    'source/model/GenerateDataKeyPairWithoutPlaintextRequest.cpp',
    'source/model/DeriveSharedSecretResult.cpp',
    'source/model/EncryptResult.cpp',
    'source/model/DisableKeyRotationRequest.cpp',
    'source/model/OriginType.cpp',
    'source/model/SignResult.cpp',
    'source/model/DataKeySpec.cpp',
    'source/model/EnableKeyRotationRequest.cpp',
    'source/model/KeyMetadata.cpp',
    'source/model/VerifyResult.cpp',
    'source/model/GrantOperation.cpp',
    'source/model/ImportState.cpp',
    'source/model/KeyMaterialState.cpp',
    'source/model/ListResourceTagsRequest.cpp',
    'source/model/VerifyMacRequest.cpp',
    'source/model/XksProxyConfigurationType.cpp',
    'source/model/ListKeyRotationsRequest.cpp',
    'source/model/VerifyRequest.cpp',
    'source/model/KeyUsageType.cpp',
    'source/model/CancelKeyDeletionRequest.cpp',
    'source/model/GenerateDataKeyRequest.cpp',
    'source/model/UpdateCustomKeyStoreResult.cpp',
    'source/model/CreateKeyRequest.cpp',
    'source/model/DecryptRequest.cpp',
    'source/model/DescribeKeyRequest.cpp',
    'source/model/CreateCustomKeyStoreRequest.cpp',
    'source/model/DeleteImportedKeyMaterialResult.cpp',
    'source/model/AlgorithmSpec.cpp',
    'source/model/VerifyMacResult.cpp',
    'source/model/GenerateMacRequest.cpp',
    'source/model/PutKeyPolicyRequest.cpp',
    'source/model/ListGrantsResult.cpp',
    'source/model/ScheduleKeyDeletionRequest.cpp',
    'source/model/DescribeCustomKeyStoresRequest.cpp',
    'source/model/ImportKeyMaterialRequest.cpp',
    'source/model/CancelKeyDeletionResult.cpp',
    'source/model/ListKeyRotationsResult.cpp',
    'source/model/AliasListEntry.cpp',
    'source/model/DeleteCustomKeyStoreResult.cpp',
    'source/model/MultiRegionKey.cpp',
    'source/model/SignRequest.cpp',
    'source/model/RetireGrantRequest.cpp',
    'source/model/DescribeKeyResult.cpp',
    'source/model/ReplicateKeyRequest.cpp',
    'source/model/UpdateAliasRequest.cpp',
    'source/model/ListKeyPoliciesResult.cpp',
    'source/model/GenerateDataKeyWithoutPlaintextRequest.cpp',
    'source/model/ListResourceTagsResult.cpp',
    'source/model/UntagResourceRequest.cpp',
    'source/model/ListRetirableGrantsRequest.cpp',
    'source/model/WrappingKeySpec.cpp',
    'source/model/CreateAliasRequest.cpp',
    'source/model/XksKeyConfigurationType.cpp',
    'source/model/KeyListEntry.cpp',
    'source/model/KeyManagerType.cpp',
    'source/model/GetKeyPolicyResult.cpp',
    'source/model/MacAlgorithmSpec.cpp',
    'source/model/GenerateDataKeyPairResult.cpp',
    'source/model/IncludeKeyMaterial.cpp',
    'source/model/DescribeCustomKeyStoresResult.cpp',
    'source/model/GrantListEntry.cpp',
    'source/model/MessageType.cpp',
    'source/model/ReplicateKeyResult.cpp',
    'source/model/RotateKeyOnDemandRequest.cpp',
    'source/model/DeleteCustomKeyStoreRequest.cpp',
    'source/model/DeriveSharedSecretRequest.cpp',
    'source/model/UpdateCustomKeyStoreRequest.cpp',
    'source/model/DeleteAliasRequest.cpp',
    'source/model/CustomKeyStoresListEntry.cpp',
    'source/model/UpdateKeyDescriptionRequest.cpp',
    'source/model/RotationsListEntry.cpp',
    'source/model/DisableKeyRequest.cpp',
    'source/model/GenerateDataKeyResult.cpp',
    'source/model/Tag.cpp',
    'source/model/GetPublicKeyResult.cpp'
)

inc = include_directories('include')

if host_machine.system() == 'windows' and get_option('default_library') == 'shared'
    cpp_args = ['-DAWS_KMS_EXPORTS=1']
else
    cpp_args = []
endif

libaws_cpp_sdk_kms = library(
    'aws-cpp-sdk-kms',
    src,
    include_directories: inc,
    cpp_args: cpp_args + public_cpp_args,
    dependencies: [aws_cpp_sdk_core_dep],
    install: true,
    version: meson.project_version(),
)

aws_cpp_sdk_kms_dep = declare_dependency(
    include_directories: inc,
    link_with: libaws_cpp_sdk_kms,
    dependencies: [aws_cpp_sdk_core_dep],
    compile_args: public_cpp_args,
)

meson.override_dependency('aws-cpp-sdk-kms', aws_cpp_sdk_kms_dep)

pkgs += {
    'aws-cpp-sdk-kms': {
        'lib': libaws_cpp_sdk_kms,
        'extra_cflags': public_cpp_args,
    }
}
